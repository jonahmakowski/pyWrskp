name: Python Formatter
on:
  workflow_dispatch:
  push:
    paths:
      - '**/*.py'

jobs:
  python_format:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4
      
      - name: Set up Python
        run: |
          apt-get update
          apt-get install -y python3 python3-pip
          apt-get install python3.11-venv
          python3 -m venv venv
          source venv/bin/activate

      - name: Install dependencies
        run: |
          pip install black
          git config --global user.email "forgejo-actions@localhost"
          git config --global user.name "Forgejo Actions"

      - name: Run Black
        run: |
          echo "Running Black..."
          black .
          git add .
          if ! git diff --cached --quiet; then
            git commit -m "ðŸ¤– Auto-format Python code" || echo "Nothing to commit"
            git push https://$FORGEJO_TOKEN@github.com/jonahmakowski/pyWrskp.git main
          fi
